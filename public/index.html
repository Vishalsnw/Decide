
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Coding Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (min-width: 1200px) {
            .main-content {
                grid-template-columns: 2fr 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #718096;
            margin-top: 10px;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        .output {
            grid-column: 1 / -1;
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .repo-list {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            background: #f7fafc;
        }

        .repo-item {
            padding: 12px;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 8px;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .repo-item:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .repo-item.selected {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
        }

        .repo-item h4 {
            margin-bottom: 4px;
            font-size: 0.95rem;
        }

        .repo-item small {
            opacity: 0.8;
            font-size: 0.8rem;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
            overflow-x: auto;
            gap: 5px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #4a5568;
            white-space: nowrap;
            transition: all 0.2s;
            border-radius: 6px 6px 0 0;
            font-size: 0.9rem;
        }

        .tab:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            background: rgba(255,255,255,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 12px;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background: #667eea;
            color: white;
            margin-left: 20px;
            border-bottom-right-radius: 4px;
        }

        .ai-message {
            background: #e2e8f0;
            color: #2d3748;
            margin-right: 20px;
            border-bottom-left-radius: 4px;
        }

        #repo-actions {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
        }

        #file-browser {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }

        .file-item {
            padding: 10px 12px;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-item:hover {
            background: #edf2f7;
            transform: translateX(5px);
        }

        .file-item i {
            width: 16px;
            text-align: center;
        }

        #file-editor {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-warning {
            background: #fefcbf;
            color: #744210;
        }

        .token-setup {
            background: #fef5e7;
            border: 1px solid #f6ad55;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .token-setup h4 {
            color: #c05621;
            margin-bottom: 8px;
        }

        .token-setup p {
            color: #744210;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .token-setup a {
            color: #c05621;
            text-decoration: none;
            font-weight: 600;
        }

        @media (max-width: 767px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .user-message, .ai-message {
                margin-left: 10px;
                margin-right: 10px;
            }
            
            .tabs {
                font-size: 0.8rem;
            }
            
            .tab {
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-robot"></i> AI Coding Assistant</h1>
            <p>Professional AI-powered coding with seamless GitHub integration</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('generate')">
                <i class="fas fa-code"></i> Generate
            </div>
            <div class="tab" onclick="switchTab('test')">
                <i class="fas fa-vial"></i> Test
            </div>
            <div class="tab" onclick="switchTab('debug')">
                <i class="fas fa-bug"></i> Debug
            </div>
            <div class="tab" onclick="switchTab('chat')">
                <i class="fas fa-comments"></i> Chat
            </div>
            <div class="tab" onclick="switchTab('github')">
                <i class="fab fa-github"></i> GitHub
            </div>
        </div>

        <div class="main-content">
            <!-- Code Generation Tab -->
            <div id="generate-content" class="tab-content active">
                <div class="card">
                    <h2><i class="fas fa-magic"></i> Generate Code</h2>
                    <div class="form-group">
                        <label for="prompt">Describe what you want to build:</label>
                        <textarea id="prompt" placeholder="e.g., Create a REST API for user authentication with JWT tokens"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="language">Programming Language:</label>
                        <select id="language">
                            <option value="javascript">JavaScript</option>
                            <option value="python">Python</option>
                            <option value="java">Java</option>
                            <option value="cpp">C++</option>
                            <option value="csharp">C#</option>
                            <option value="go">Go</option>
                            <option value="rust">Rust</option>
                            <option value="typescript">TypeScript</option>
                            <option value="php">PHP</option>
                            <option value="ruby">Ruby</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="context">Additional Context (optional):</label>
                        <textarea id="context" placeholder="Framework preferences, specific requirements, or existing code context"></textarea>
                    </div>
                    <button class="btn" onclick="generateCode()">
                        <i class="fas fa-magic"></i> Generate Code
                    </button>
                </div>
            </div>

            <!-- Test Generation Tab -->
            <div id="test-content" class="tab-content">
                <div class="card">
                    <h2><i class="fas fa-vial"></i> Generate Tests</h2>
                    <div class="form-group">
                        <label for="test-code">Code to Test:</label>
                        <textarea id="test-code" placeholder="Paste your code here"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="test-language">Language:</label>
                        <select id="test-language">
                            <option value="javascript">JavaScript</option>
                            <option value="python">Python</option>
                            <option value="java">Java</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="test-framework">Test Framework:</label>
                        <select id="test-framework">
                            <option value="jest">Jest (JavaScript)</option>
                            <option value="pytest">Pytest (Python)</option>
                            <option value="junit">JUnit (Java)</option>
                        </select>
                    </div>
                    <button class="btn" onclick="generateTests()">
                        <i class="fas fa-vial"></i> Generate Tests
                    </button>
                </div>
            </div>

            <!-- Debug Tab -->
            <div id="debug-content" class="tab-content">
                <div class="card">
                    <h2><i class="fas fa-bug"></i> Debug Code</h2>
                    <div class="form-group">
                        <label for="debug-code">Problematic Code:</label>
                        <textarea id="debug-code" placeholder="Paste your code with issues"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="error-message">Error Message:</label>
                        <textarea id="error-message" placeholder="Paste the error message or describe the issue"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="debug-language">Language:</label>
                        <select id="debug-language">
                            <option value="javascript">JavaScript</option>
                            <option value="python">Python</option>
                            <option value="java">Java</option>
                            <option value="cpp">C++</option>
                        </select>
                    </div>
                    <button class="btn" onclick="debugCode()">
                        <i class="fas fa-wrench"></i> Debug & Fix
                    </button>
                </div>
            </div>

            <!-- Chat Tab -->
            <div id="chat-content" class="tab-content">
                <div class="card">
                    <h2><i class="fas fa-comments"></i> Chat with AI Assistant</h2>
                    <div id="chat-messages" style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f7fafc;">
                        <div class="ai-message">👋 Hello! I'm your AI coding assistant. Ask me anything about programming, debugging, architecture, or development best practices!</div>
                    </div>
                    <div class="form-group">
                        <label for="chat-input">Your message:</label>
                        <textarea id="chat-input" placeholder="Ask me about coding, debugging, best practices, or any development questions..." rows="3"></textarea>
                    </div>
                    <button class="btn" onclick="sendChatMessage()">
                        <i class="fas fa-paper-plane"></i> Send Message
                    </button>
                </div>
            </div>

            <!-- GitHub Tab -->
            <div id="github-content" class="tab-content">
                <div class="card">
                    <h2><i class="fab fa-github"></i> GitHub Integration</h2>
                    
                    <div class="token-setup" id="token-setup">
                        <h4><i class="fas fa-exclamation-triangle"></i> GitHub Token Setup Required</h4>
                        <p>To access your repositories, you need to set up a GitHub Personal Access Token:</p>
                        <ol style="margin-left: 20px; color: #744210;">
                            <li>Go to <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings → Developer settings → Personal access tokens</a></li>
                            <li>Generate a new token with <strong>repo</strong> and <strong>user</strong> scopes</li>
                            <li>Copy the token and add it to your environment variables as <code>GITHUB_TOKEN</code></li>
                        </ol>
                    </div>

                    <button class="btn" onclick="loadRepos()" style="margin-bottom: 20px;">
                        <i class="fas fa-sync-alt"></i> Load My Repositories
                    </button>
                    
                    <div id="repo-list" class="repo-list"></div>

                    <div id="repo-actions">
                        <h3><i class="fas fa-folder-open"></i> Selected Repository: <span id="selected-repo-name"></span></h3>
                        <button class="btn" onclick="browseFiles()">
                            <i class="fas fa-search"></i> Browse Files
                        </button>
                    </div>

                    <div id="file-browser"></div>

                    <div id="file-editor">
                        <h3><i class="fas fa-file-code"></i> Editing: <span id="current-file-path"></span></h3>
                        <div class="form-group">
                            <label for="file-content">File Content:</label>
                            <textarea id="file-content" rows="15" placeholder="File content will appear here..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="modification-request">AI Modification Request:</label>
                            <textarea id="modification-request" placeholder="e.g., Add error handling, optimize performance, fix the authentication bug"></textarea>
                        </div>
                        <button class="btn" onclick="aiModifyCode()">
                            <i class="fas fa-robot"></i> AI Modify Code
                        </button>
                        <button class="btn btn-secondary" onclick="saveFile()">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>

                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                        <h4><i class="fas fa-plus"></i> Create New File</h4>
                        <div class="form-group">
                            <label for="file-path">File Path:</label>
                            <input type="text" id="file-path" placeholder="e.g., src/components/Header.js">
                        </div>
                        <div class="form-group">
                            <label for="new-file-content">File Content:</label>
                            <textarea id="new-file-content" rows="10" placeholder="Enter the content for your new file..."></textarea>
                        </div>
                        <button class="btn" onclick="saveNewFile()">
                            <i class="fas fa-plus-circle"></i> Create File
                        </button>
                    </div>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processing your request...</p>
            </div>
        </div>

        <div class="output" id="output">
            <div style="text-align: center; padding: 20px;">
                <h3>🚀 Welcome to AI Coding Assistant!</h3>
                <p style="margin: 15px 0;">Your professional AI-powered development companion</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; text-align: left;">
                    <div>✅ Generate production-ready code</div>
                    <div>🧪 Create comprehensive tests</div>
                    <div>🐛 Debug and fix issues</div>
                    <div>📂 GitHub repository integration</div>
                    <div>💬 Interactive AI assistance</div>
                    <div>📱 Mobile-responsive design</div>
                </div>
                <p style="margin-top: 20px; font-style: italic; opacity: 0.8;">Start by selecting a tab above or ask me anything!</p>
            </div>
        </div>
    </div>

    <script>
        let selectedRepo = null;
        let currentFile = null;

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-content').classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function updateOutput(content) {
            document.getElementById('output').innerHTML = content;
        }

        async function loadRepos() {
            const output = document.getElementById('output');
            showLoading();

            try {
                const response = await fetch('/api/github/repos');
                const data = await response.json();

                if (data.success) {
                    const repoList = document.getElementById('repo-list');
                    repoList.innerHTML = '';

                    if (data.repos.length === 0) {
                        repoList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No repositories found</p>';
                    } else {
                        data.repos.forEach(repo => {
                            const repoItem = document.createElement('div');
                            repoItem.className = 'repo-item';
                            repoItem.innerHTML = `
                                <h4><i class="fas fa-${repo.private ? 'lock' : 'unlock'}"></i> ${repo.name}</h4>
                                <small>${repo.description || 'No description available'}</small>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">
                                    <i class="fas fa-code"></i> ${repo.language || 'Unknown'} • 
                                    <i class="fas fa-clock"></i> ${new Date(repo.updated_at).toLocaleDateString()}
                                </div>
                            `;
                            repoItem.onclick = () => selectRepo(repo, repoItem);
                            repoList.appendChild(repoItem);
                        });
                        
                        // Hide token setup message on success
                        document.getElementById('token-setup').style.display = 'none';
                    }

                    updateOutput(`<span class="status-badge status-success">✅ Success</span> Loaded ${data.repos.length} repositories`);
                } else {
                    updateOutput(`<span class="status-badge status-error">❌ Error</span> ${data.error}`);
                    // Show token setup message on error
                    document.getElementById('token-setup').style.display = 'block';
                }
            } catch (error) {
                updateOutput(`<span class="status-badge status-error">❌ Network Error</span> ${error.message}`);
            }

            hideLoading();
        }

        function selectRepo(repo, element) {
            selectedRepo = repo;
            document.querySelectorAll('.repo-item').forEach(item => item.classList.remove('selected'));
            element.classList.add('selected');

            document.getElementById('selected-repo-name').textContent = repo.full_name;
            document.getElementById('repo-actions').style.display = 'block';
            
            updateOutput(`<span class="status-badge status-success">✅ Selected</span> Repository: ${repo.full_name}`);
        }

        async function browseFiles(path = '') {
            if (!selectedRepo) return;

            showLoading();

            try {
                const response = await fetch(`/api/github/files/${selectedRepo.full_name}?path=${path}`);
                const data = await response.json();

                if (data.success) {
                    const fileBrowser = document.getElementById('file-browser');
                    fileBrowser.innerHTML = '<h4><i class="fas fa-folder"></i> Repository Files</h4>';

                    if (path) {
                        const backItem = document.createElement('div');
                        backItem.className = 'file-item';
                        backItem.innerHTML = '<i class="fas fa-arrow-left"></i> <strong>← Back</strong>';
                        backItem.onclick = () => browseFiles(path.split('/').slice(0, -1).join('/'));
                        fileBrowser.appendChild(backItem);
                    }

                    data.files.forEach(file => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';
                        const icon = file.type === 'dir' ? 'fas fa-folder' : 'fas fa-file-code';
                        fileItem.innerHTML = `
                            <i class="${icon}"></i>
                            <span>${file.name}</span>
                            ${file.type === 'file' ? `<small style="margin-left: auto; opacity: 0.7;">${formatFileSize(file.size)}</small>` : ''}
                        `;

                        fileItem.onclick = () => {
                            if (file.type === 'dir') {
                                browseFiles(file.path);
                            } else {
                                loadFileContent(file.path);
                            }
                        };

                        fileBrowser.appendChild(fileItem);
                    });

                    updateOutput(`<span class="status-badge status-success">✅ Loaded</span> ${data.files.length} items from ${path || 'root'}`);
                } else {
                    updateOutput(`<span class="status-badge status-error">❌ Error</span> ${data.error}`);
                }
            } catch (error) {
                updateOutput(`<span class="status-badge status-error">❌ Error</span> ${error.message}`);
            }

            hideLoading();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        async function loadFileContent(filePath) {
            if (!selectedRepo) return;

            showLoading();

            try {
                const response = await fetch(`/api/github/file/${selectedRepo.full_name}/${filePath}`);
                const data = await response.json();

                if (data.success) {
                    currentFile = data;
                    document.getElementById('current-file-path').textContent = filePath;
                    document.getElementById('file-content').value = data.content;
                    document.getElementById('file-editor').style.display = 'block';

                    updateOutput(`<span class="status-badge status-success">✅ Loaded</span> File: ${filePath} (${formatFileSize(data.content.length)} chars)`);
                } else {
                    updateOutput(`<span class="status-badge status-error">❌ Error</span> ${data.error}`);
                }
            } catch (error) {
                updateOutput(`<span class="status-badge status-error">❌ Error</span> ${error.message}`);
            }

            hideLoading();
        }

        async function aiModifyCode() {
            if (!selectedRepo || !currentFile) {
                alert('Please select a repository and load a file first');
                return;
            }

            const modificationRequest = document.getElementById('modification-request').value;
            const currentContent = document.getElementById('file-content').value;

            if (!modificationRequest.trim()) {
                alert('Please enter a modification request');
                return;
            }

            showLoading();

            try {
                const fileExtension = currentFile.path.split('.').pop().toLowerCase();
                const languageMap = {
                    'js': 'javascript', 'jsx': 'javascript', 'ts': 'typescript', 'tsx': 'typescript',
                    'py': 'python', 'java': 'java', 'cpp': 'cpp', 'c': 'c', 'cs': 'csharp',
                    'php': 'php', 'rb': 'ruby', 'go': 'go', 'rs': 'rust', 'html': 'html',
                    'css': 'css', 'scss': 'scss', 'sass': 'sass'
                };

                const language = languageMap[fileExtension] || 'text';

                const response = await fetch('/api/github/ai-modify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        owner: selectedRepo.full_name.split('/')[0],
                        repo: selectedRepo.full_name.split('/')[1],
                        filePath: currentFile.path,
                        currentContent,
                        modification: modificationRequest,
                        language
                    })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('file-content').value = data.modifiedCode;
                    updateOutput(`<span class="status-badge status-success">✅ AI Modified</span> Code has been modified! Review changes and save when ready.`);
                } else {
                    updateOutput(`<span class="status-badge status-error">❌ Error</span> ${data.error}`);
                }
            } catch (error) {
                updateOutput(`<span class="status-badge status-error">❌ Error</span> ${error.message}`);
            }

            hideLoading();
        }

        async function saveFile() {
            if (!selectedRepo || !currentFile) {
                alert('Please select a repository and load a file first');
                return;
            }

            const filePath = currentFile.path;
            const fileContent = document.getElementById('file-content').value;

            if (!fileContent.trim()) {
                alert('File content cannot be empty');
                return;
            }

            showLoading();

            try {
                const [owner, repo] = selectedRepo.full_name.split('/');
                const response = await fetch('/api/github/update-file', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        owner,
                        repo,
                        path: filePath,
                        content: fileContent,
                        message: `Update ${filePath} via AI Coding Assistant`
                    })
                });

                const data = await response.json();

                if (data.success) {
                    updateOutput(`<span class="status-badge status-success">✅ Saved</span> File updated successfully! Commit: ${data.commit.sha.substring(0, 7)}`);
                    document.getElementById('modification-request').value = '';
                } else {
                    updateOutput(`<span class="status-badge status-error">❌ Error</span> ${data.error}`);
                }
            } catch (error) {
                updateOutput(`<span class="status-badge status-error">❌ Error</span> ${error.message}`);
            }

            hideLoading();
        }

        async function saveNewFile() {
            if (!selectedRepo) {
                alert('Please select a repository first');
                return;
            }

            const filePath = document.getElementById('file-path').value.trim();
            const fileContent = document.getElementById('new-file-content').value;

            if (!filePath || !fileContent.trim()) {
                alert('Please provide both file path and content');
                return;
            }

            showLoading();

            try {
                const [owner, repo] = selectedRepo.full_name.split('/');
                const response = await fetch('/api/github/update-file', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        owner,
                        repo,
                        path: filePath,
                        content: fileContent,
                        message: `Create ${filePath} via AI Coding Assistant`
                    })
                });

                const data = await response.json();

                if (data.success) {
                    updateOutput(`<span class="status-badge status-success">✅ Created</span> New file created successfully! Commit: ${data.commit.sha.substring(0, 7)}`);
                    document.getElementById('file-path').value = '';
                    document.getElementById('new-file-content').value = '';
                } else {
                    updateOutput(`<span class="status-badge status-error">❌ Error</span> ${data.error}`);
                }
            } catch (error) {
                updateOutput(`<span class="status-badge status-error">❌ Error</span> ${error.message}`);
            }

            hideLoading();
        }

        async function generateCode() {
            const prompt = document.getElementById('prompt').value.trim();
            const language = document.getElementById('language').value;
            const context = document.getElementById('context').value.trim();

            if (!prompt) {
                alert('Please enter a description of what you want to build');
                return;
            }

            showLoading();

            try {
                const response = await fetch('/api/generate-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, language, context })
                });

                const result = await response.json();

                if (result.success) {
                    updateOutput(`<span class="status-badge status-success">✅ Generated</span> ${language} code:\n\n${result.code}`);
                    document.getElementById('new-file-content').value = result.code;
                } else {
                    updateOutput(`<span class="status-badge status-error">❌ Error</span> ${result.error}`);
                }
            } catch (error) {
                updateOutput(`<span class="status-badge status-error">❌ Error</span> ${error.message}`);
            }

            hideLoading();
        }

        async function generateTests() {
            const code = document.getElementById('test-code').value.trim();
            const language = document.getElementById('test-language').value;
            const framework = document.getElementById('test-framework').value;

            if (!code) {
                alert('Please enter code to test');
                return;
            }

            showLoading();

            try {
                const response = await fetch('/api/generate-tests', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, language, testFramework: framework })
                });

                const result = await response.json();

                if (result.success) {
                    updateOutput(`<span class="status-badge status-success">✅ Generated</span> ${framework} tests:\n\n${result.tests}`);
                } else {
                    updateOutput(`<span class="status-badge status-error">❌ Error</span> ${result.error}`);
                }
            } catch (error) {
                updateOutput(`<span class="status-badge status-error">❌ Error</span> ${error.message}`);
            }

            hideLoading();
        }

        async function debugCode() {
            const code = document.getElementById('debug-code').value.trim();
            const error = document.getElementById('error-message').value.trim();
            const language = document.getElementById('debug-language').value;

            if (!code || !error) {
                alert('Please enter both the problematic code and error message');
                return;
            }

            showLoading();

            try {
                const response = await fetch('/api/debug-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, error, language })
                });

                const result = await response.json();

                if (result.success) {
                    updateOutput(`<span class="status-badge status-success">✅ Debug Complete</span>\n\n${result.debug}`);
                } else {
                    updateOutput(`<span class="status-badge status-error">❌ Error</span> ${result.error}`);
                }
            } catch (error) {
                updateOutput(`<span class="status-badge status-error">❌ Error</span> ${error.message}`);
            }

            hideLoading();
        }

        async function sendChatMessage() {
            const chatInput = document.getElementById('chat-input');
            const message = chatInput.value.trim();

            if (!message) {
                alert('Please enter a message');
                return;
            }

            addChatMessage(message, 'user');
            chatInput.value = '';

            showLoading();

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });

                const result = await response.json();

                if (result.success) {
                    addChatMessage(result.response, 'ai');
                } else {
                    addChatMessage(`Error: ${result.error}`, 'ai');
                }
            } catch (error) {
                addChatMessage(`Error: ${error.message}`, 'ai');
            }

            hideLoading();
        }

        function addChatMessage(message, sender) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            const icon = sender === 'user' ? '👤' : '🤖';
            messageDiv.innerHTML = `${icon} ${message}`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('chat-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    sendChatMessage();
                }
            });
        });
    </script>
</body>
</html>
